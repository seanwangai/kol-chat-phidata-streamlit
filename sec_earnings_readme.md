# SEC & Earnings 分析师 - 当前状态报告

## 概述
SEC & Earnings 分析师是一个专业的财务数据综合分析平台，能够自动获取和分析SEC文件和财报会议记录，为用户提供全面的财务分析报告。

## 核心功能

### 1. 数据获取能力
- **SEC文件**: 支持获取10-K, 10-Q, 8-K, 20-F, 6-K, F-1, S-1等多种类型的SEC文件
- **财报会议记录**: 从discountingcashflows.com获取earnings call transcripts
- **时间范围**: 支持1-10年的历史数据获取
- **智能日期解析**: 自动从HTML页面提取真实的会议日期

### 2. AI分析流程
系统采用4步骤的智能分析流程：

#### 步骤1: 问题分析 (7个子步骤)
- 1.1: 开始分析用户问题
- 1.2: 理解问题核心意图
- 1.3: 构建分析提示词
- 1.4: 调用AI模型分析问题
- 1.5: 解析AI响应
- 1.6: 生成处理提示词和统整提示词
- 1.7: 问题分析完成，准备获取数据

#### 步骤2: 数据获取 (15个子步骤)
**SEC文件获取 (步骤2.1-2.5)**
- 2.1: 初始化SEC文件获取
- 2.2: 连接SEC EDGAR数据库
- 2.3: 查找公司CIK编号
- 2.4: 获取公司近N年的SEC文件列表
- 2.5: 成功获取SEC文件

**财报会议记录获取 (步骤2.6-2.12)**
- 2.6: 初始化财报会议记录获取
- 2.7: 连接discountingcashflows.com
- 2.8: 查找公司的所有财报会议记录
- 2.9: 找到财报会议记录，开始获取真实日期
- 2.10.X: 逐个获取每个会议的真实日期
- 2.11: 过滤近N年的财报会议记录
- 2.12: 成功获取符合条件的财报会议记录

**数据整合 (步骤2.13-2.15)**
- 2.13: 合并所有文档
- 2.14: 按日期排序（最新的在前）
- 2.15: 数据获取完成，准备开始分析

#### 步骤3: 文档处理 (流式处理，每个文档7个子步骤)
- 3.X.1: 开始处理文档
- 3.X.2: 获取文档内容
- 3.X.3: 内容获取完成，显示长度
- 3.X.4: 内容长度检查和截断
- 3.X.5: 使用AI模型分析文档
- 3.X.6: 文档分析完成，生成结果
- 3.X.7: 单个文档处理完成

#### 步骤4: 综合分析 (8个子步骤)
- 4.1: 开始生成综合分析报告
- 4.2: 收集所有文档分析结果
- 4.3: 构建综合分析提示词
- 4.4: 整合所有文档分析结果
- 4.5: 调用AI模型生成综合分析
- 4.6: 格式化最终报告
- 4.7: 添加综合分析报告到对话
- 4.8: 分析完成，清理处理状态

### 3. 技术特性

#### 数据获取优化
- **多头请求**: 使用完整的HTTP头部信息模拟真实浏览器请求
- **会话管理**: 通过session维护cookies和状态
- **错误处理**: 完善的异常处理机制
- **日期解析**: 支持多种日期格式的自动识别

#### AI模型支持
- **Gemini 2.5 Flash**: 默认模型，速度快，成本低
- **Gemini 2.5 Pro**: 高质量分析，适合复杂任务
- **智能提示词**: 根据用户问题自动生成专业的分析提示词

#### 流式处理
- **即时反馈**: 每个文档分析完成后立即显示结果
- **进度追踪**: 详细的步骤进度显示
- **状态管理**: 完整的处理状态管理

## 最新更新 (2024-01-15)

### 修复项目
1. **详细步骤显示**: 将所有处理步骤细分为更详细的子步骤，让用户清楚了解每一步的进展
2. **Earnings Call日期解析**: 修复了日期解析器，参考test_earnings_transcript_parser.py的实现
3. **HTML结构解析**: 正确解析 `<div class="flex flex-wrap justify-between bg-base-200 rounded-box p-4">` 结构中的日期信息
4. **请求头优化**: 使用完整的浏览器请求头，提高获取成功率

### 技术改进
- **错误日志**: 添加详细的调试信息输出
- **日期格式**: 支持多种日期格式 (November 17, 2022 / Nov 17, 2022 / 2022-11-17 / 11/17/2022)
- **会话建立**: 先访问主页面建立会话，再获取具体内容
- **状态图标**: 使用emoji图标增强步骤可读性

## 使用说明

1. **输入股票代码**: 输入要分析的公司股票代码
2. **选择时间范围**: 设置获取数据的年数 (1-10年)
3. **选择数据类型**: 选择SEC文件和/或财报会议记录
4. **选择AI模型**: 选择分析使用的AI模型
5. **输入问题**: 输入具体的分析问题
6. **查看结果**: 系统会显示详细的处理进度和分析结果

## 系统要求

- Python 3.8+
- Streamlit
- 网络连接 (访问SEC EDGAR和discountingcashflows.com)
- Google Gemini API密钥

## 文件结构

```
pages/SEC_Earnings_Analyzer.py - 主文件
test_earnings_transcript_parser.py - 参考实现
transcript_BABA_Q2_2023.html - 测试HTML文件
sec_earnings_readme.md - 本文档
```

## 已知问题

1. **网络依赖**: 需要稳定的网络连接访问外部数据源
2. **API限制**: 受Google Gemini API的速率限制
3. **数据延迟**: 数据可能有1-2个工作日的延迟

## 未来计划

1. **缓存机制**: 实现本地缓存避免重复请求
2. **更多数据源**: 添加更多财务数据源
3. **可视化**: 添加图表和可视化功能
4. **导出功能**: 支持PDF/Excel导出

---
*最后更新: 2024-01-15* 